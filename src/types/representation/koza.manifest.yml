id: representation/koza_tree
composer: |
  s["min_depth"] = Base.get(s, "min_depth", 1)
  s["max_depth"] = Base.get(s, "max_depth", 9)

  # Construct each input.
  s["inputs"] = Base.get(s, "inputs", String[])
  s["inputs"] = KozaInput[KozaInput(i) for i in s["inputs"]]

  # Construct the tree type.
  tt = ComposeKozaTree(s["inputs"])

  # Construct the builder.
  # If none is given, default to ramped-half-and-half with 0.5 grow probability.
  s["builder"] = Base.get(s, "builder", {
    "type" => "koza:builder/half_and_half",
    "min_depth" => 2,
    "max_depth" => 6,
    "prob_terminals" => 0.5,
    "prob_grow" => 0.5
  })
  s["builder"]["tree"] = tt
  s["builder"] = compose_as(s["builder"], s["builder"]["type"])

  # Construct each terminal.
  s["terminals"] = Base.get(s, "terminals", String[])
  s["terminals"] = KozaTerminal[
    apply(ComposeKozaTerminal(s["inputs"], t)) for t in s["terminals"]]

  # Construct each non-terminal.
  s["non_terminals"] = Base.get(s, "non_terminals", String[])
  s["non_terminals"] = KozaNonTerminal[
    apply(ComposeKozaNonTerminal(s["inputs"], nt)) for nt in s["non_terminals"]]

  return KozaTreeRepresentation(tt,
    s["min_depth"],
    s["max_depth"],
    s["terminals"],
    s["non_terminals"],
    s["inputs"],
    s["builder"])
