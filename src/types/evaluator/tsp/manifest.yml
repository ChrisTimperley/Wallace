id: evaluator/tsp

description: |
  Evaluates the fitness of a TSP tour for a pre-determined geometric problem.

properties:
  threads:
    type:         Integer
    description:  >
      The number of threads that the evaluation process should be split across.

  file:
    type: String
    description: >
      The path to the file containing the co-ordinates of each of the cities
      for the geometric TSP instance being solved.

composer: |

  # Determine number of threads to use.
  s["threads"] = int(get(s, "threads", 1))
  s["threads"] < 1 && s["threads"] = 1

  # Load the contents of the file and convert into a list of co-ordinates.
  coords = open(s["file"], "r") do f
    c = Vector{Float}[]
    for ln in eachline(f)
      !isempty(ln) && push!(c, Float[float(x) for x in split(ln, ",")]) 
    end
    c
  end
  num = length(coords)

  # Generate a distance matrix from the set of co-ordinates.
  matrix = Array(Float, num, num)
  for i = 1:n
    for j = 1:n
      matrix[i, j] = sqrt(sum((cities[i] - cities[j]) .^ 2))
    end
  end

  # Build and return the evaluator.
  return TSPEvaluator(dist_matrix, s["threads"])
